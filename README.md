# Astro-Imaging Scripts

A collection of scripts to query, download, process, and combine astronomical data into a final image.
Create False-Color-Images with a few easyt-to-use Scripts around astroquery & astropy

## Setup




---

# Step by Step Example

To create a false color image, you need to use the scripts in the following order.
Running all the commands 

```
in these boxes 
```

will create an example False Color Image for Messer 74.

## 1. query_observation_lists.py


This script queries the MAST archive for observation data of a specific target and saves the results to a CSV file. You need an API key from [mast.stsci.edu](https://mast.stsci.edu/) for quering. 

Export it as MAST_API_TOKEN to your environment

or 

create an .env file in the same directory as this README.md is in with the contents: 

MAST_API_TOKEN="$YOUR_API_TOKEN_HERE" 

or 

simply enter it when the script asks for it. 


Finding the exact target_name can be tricky, for example for the target_name for Messer 74 is "NGC-628". Searching for "NGC 628", "M-74" or "M74" will not yield results. Use https://mast.stsci.edu/portal/Mashup/Clients/Mast/Portal.html if you have trouble find the correct target_name. 

* `--target_name` (required): The name of the celestial object to query.
* `--calib_level` (optional, default: 3): The calibration level of the data.
* `--project` (optional, default: JWST): The telescope or project to query.
* `--outdir` (optional, default: csv): The output directory for the CSV file.

### Example Usage:
```
python src/query_observation_lists.py --target_name="NGC-628"
```
---

## 2. download_from_csv.py

This script downloads the actual data files (FITS, JPG) listed in the CSV generated by the query script.

* `--csv` (required): Path to the input CSV file.
* `--outdir` (optional): The directory where files will be saved.
* `--ignore_jpgs` (optional): A flag to skip downloading JPG preview images.
* `--ignore_fits` (optional): A flag to skip downloading scientific FITS files.
* `--must_contain` (optional): A filter string that must be in the filename to be downloaded.

As fits data can be quite large and the downloads can be rather slow, it is advisable to run with the --ignore_fits argument first. 
Unfortunatly "same" observations can only be consistently identified through a string in the filename. 

Running

```
python src/download_from_csv.py --csv="outputs/csv/NGC-628.csv" --ignore_fits
```

will give us JPGs of different observations. We can further select by using the --must_contain argument like this:


```
python src/download_from_csv.py --csv="outputs/csv/NGC-628.csv" --must_contain="o039"
```

This will then download the fits for the obervation with the identifier. 

---

## 3. extract_png_from_fits.py

This script processes and aligns scientific FITS files into 8-bit PNG images. It uses a JSON configuration file to define which files to process and what parameters to use for visual scaling.

* `--input_json` (required): Path to the JSON file that configures the FITS processing.
* `--outdir` (optional): The directory where the output PNGs will be saved.


### Example Usage:

```
python src/extract_png_from_fits.py --input_json="configs\extract\ngc628_o039_extract_a_lot.json"
```

### JSON Schema:

```
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Image Processing Parameters",
  "description": "A schema for defining parameter grids for MAST image processing normalization.",
  "type": "object",
  "properties": {
    "stretch_function": {
      "description": "A list of stretching functions to apply to the raw image data.",
      "type": "array",
      "items": {
        "type": "string",
        "enum": [
          "LinearStretch",
          "SqrtStretch",
          "LogStretch",
          "AsinhStretch"
        ]
      }
    },
    "percentile_black": {
      "description": "A list of percentile values to map to black.",
      "type": "array",
      "items": {
        "type": "number",
        "minimum": 0,
        "maximum": 100
      }
    },
    "percentile_white": {
      "description": "A list of percentile values to map to white.",
      "type": "array",
      "items": {
        "type": "number",
        "minimum": 0,
        "maximum": 100
      }
    },
    "background_color": {
      "description": "A list of background color values, likely for masking or padding.",
      "type": "array",
      "items": {
        "type": "integer"
        "minimum": 0,
        "maximum": 255
      }
    },
    "replace_below_black": {
      "description": "A list of values to replace pixels that are darker than the black point.",
      "type": "array",
      "items": {
        "type": "integer"
        "minimum": 0,
        "maximum": 255
      }
    },
    "replace_above_white": {
      "description": "A list of values to replace pixels that are brighter than the white point.",
      "type": "array",
      "items": {
        "type": "integer",
        "minimum": 0,
        "maximum": 255
      }
    }
  },
  "required": [
    "stretch_function",
    "percentile_black",
    "percentile_white",
    "background_color",
    "replace_below_black",
    "replace_above_white"
  ]
}

```


---

## 4. combiner.py

This script combines several processed PNGs into a single full-color composite image. It uses a JSON configuration file to assign specific images to color channels and set their brightness.

* `--input_json` (required): Path to the JSON file that configures the image combination.
* `--imagename` (optional): The base name for the final output image.
* `--suffix` (optional): A suffix to append to the output filename.
* `--outdir` (optional, default: outs): The directory for the final image.

### Example Usage:

```
python combiner.py --input_json=""
```

### JSON Schema: